<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create Quiz</title>
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <style>
      .step-content {
        margin-top: 1rem;
      }
      .step-button {
        margin-top: 1rem;
      }
    </style>
  </head>
  <body>
    {% extends "base.html" %} {% block content %}
    <div class="container mt-5">
      <h1>Create a New Quiz</h1>
      <form id="quiz-form" method="post">
        <!-- Nav Tabs -->
        <ul class="nav nav-tabs" id="myTab" role="tablist">
          <li class="nav-item">
            <a
              class="nav-link active"
              id="quiz-details-tab"
              data-toggle="tab"
              href="#quiz-details"
              role="tab"
              aria-controls="quiz-details"
              aria-selected="true"
              >Quiz Details</a
            >
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              id="questions-tab"
              data-toggle="tab"
              href="#questions"
              role="tab"
              aria-controls="questions"
              aria-selected="false"
              >Questions</a
            >
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              id="translations-tab"
              data-toggle="tab"
              href="#translations"
              role="tab"
              aria-controls="translations"
              aria-selected="false"
              >Translations</a
            >
          </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="myTabContent">
          <!-- Quiz Details -->
          <div
            class="tab-pane fade show active step-content"
            id="quiz-details"
            role="tabpanel"
            aria-labelledby="quiz-details-tab"
          >
            <div class="mb-3">
              <label for="title" class="form-label">Quiz Title</label>
              <input
                type="text"
                class="form-control"
                id="title"
                name="title"
                required
              />
            </div>
          </div>

          <!-- Questions -->
          <div
            class="tab-pane fade step-content"
            id="questions"
            role="tabpanel"
            aria-labelledby="questions-tab"
          >
            <div id="questions-container">
              <!-- Initial Question Block -->
              <div class="question-container mb-3">
                <h5>Question 1</h5>
                <input
                  type="text"
                  class="form-control mb-2"
                  name="question_text_1"
                  placeholder="Question Title"
                  required
                />
                <div
                  class="d-flex justify-content-between align-items-center mb-2"
                >
                  <button
                    type="button"
                    class="btn btn-secondary btn-sm"
                    onclick="addOption(1)"
                  >
                    Add Option
                  </button>
                  <button
                    type="button"
                    class="btn btn-danger btn-sm"
                    onclick="removeQuestion(this)"
                  >
                    Remove Question
                  </button>
                </div>
                <div class="option-container mb-2">
                  <div class="option-block mb-2">
                    <input
                      type="text"
                      class="form-control mb-1"
                      name="option_text_1_1"
                      placeholder="Option 1"
                      required
                    />
                    <div class="form-check">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        name="correct_1_1"
                        value="Option 1"
                      />
                      <label class="form-check-label">Correct Option</label>
                    </div>
                  </div>
                </div>
              </div>
              <!-- End of Initial Question Block -->
            </div>
            <button type="button" class="btn btn-primary" id="add-question">
              Add Another Question
            </button>
          </div>

          <!-- Translations -->
          <div
            class="tab-pane fade step-content"
            id="translations"
            role="tabpanel"
            aria-labelledby="translations-tab"
          >
            <div id="translations-container">
              <!-- Initial Translation Block -->
              <div class="translation-container mb-3">
                <h5>Translations for Question 1</h5>
                <div class="mb-3">
                  <label for="translation_question_text_1_fr" class="form-label"
                    >French Translation:</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="translation_question_text_1_fr"
                    name="translation_question_text_1_fr"
                  />
                </div>
                <div class="mb-3">
                  <label for="translation_question_text_1_ar" class="form-label"
                    >Arabic Translation:</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="translation_question_text_1_ar"
                    name="translation_question_text_1_ar"
                  />
                </div>
                <div class="mb-3" id="translations-options-1">
                  <h6>Translations for Options</h6>
                  <!-- Option translations will be added dynamically -->
                </div>
              </div>
              <!-- End of Initial Translation Block -->
            </div>
          </div>
        </div>

        <div class="step-button">
          <button type="submit" class="btn btn-success">Save Quiz</button>
        </div>
      </form>
    </div>

    <script>
      let questionCount = 1;
      let optionCounts = { 1: 1 }; // Keeps track of options count per question

      function addQuestion() {
        questionCount++;
        optionCounts[questionCount] = 1; // Initialize options count for new question
        const container = document.getElementById("questions-container");
        const questionBlock = document.createElement("div");
        questionBlock.className = "question-container mb-3";
        questionBlock.innerHTML = `
                <h5>Question ${questionCount}</h5>
                <input type="text" class="form-control mb-2" name="question_text_${questionCount}" placeholder="Question Title" required>
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <button type="button" class="btn btn-secondary btn-sm" onclick="addOption(${questionCount})">Add Option</button>
                    <button type="button" class="btn btn-danger btn-sm" onclick="removeQuestion(this)">Remove Question</button>
                </div>
                <div class="option-container mb-2">
                    <div class="option-block mb-2">
                        <input type="text" class="form-control mb-1" name="option_text_${questionCount}_1" placeholder="Option 1" required>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="correct_${questionCount}_1" value="Option 1">
                            <label class="form-check-label">Correct Option</label>
                        </div>
                    </div>
                </div>
            `;
        container.appendChild(questionBlock);
        addTranslationFields(questionCount);
      }

      function addOption(questionId) {
        optionCounts[questionId]++;
        const optionContainer = document.querySelector(
          `.question-container:nth-of-type(${questionId}) .option-container`
        );
        const optionBlock = document.createElement("div");
        optionBlock.className = "option-block mb-2";
        optionBlock.innerHTML = `
                <input type="text" class="form-control mb-1" name="option_text_${questionId}_${optionCounts[questionId]}" placeholder="Option ${optionCounts[questionId]}" required>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="correct_${questionId}_${optionCounts[questionId]}" value="Option ${optionCounts[questionId]}">
                    <label class="form-check-label">Correct Option</label>
                </div>
            `;
        optionContainer.appendChild(optionBlock);

        // Add corresponding translation fields
        const translationContainer = document.getElementById(
          `translations-options-${questionId}`
        );
        const translationBlock = document.createElement("div");
        translationBlock.className = "mb-3";
        translationBlock.innerHTML = `
                <label for="translation_option_text_${questionId}_${optionCounts[questionId]}_fr" class="form-label">Option ${optionCounts[questionId]} - French:</label>
                <input type="text" class="form-control mb-2" id="translation_option_text_${questionId}_${optionCounts[questionId]}_fr" name="translation_option_text_${questionId}_${optionCounts[questionId]}_fr">
                <label for="translation_option_text_${questionId}_${optionCounts[questionId]}_ar" class="form-label">Option ${optionCounts[questionId]} - Arabic:</label>
                <input type="text" class="form-control" id="translation_option_text_${questionId}_${optionCounts[questionId]}_ar" name="translation_option_text_${questionId}_${optionCounts[questionId]}_ar">
            `;
        translationContainer.appendChild(translationBlock);
      }

      function removeQuestion(button) {
        const questionContainer = button.closest(".question-container");
        questionContainer.remove();
        // Also remove the associated translation fields
        const questionId = questionContainer
          .querySelector('input[name^="question_text"]')
          .name.replace("question_text_", "");
        document
          .querySelector(
            `#translations-container .translation-container:nth-of-type(${questionId})`
          )
          .remove();
      }

      function addTranslationFields(questionId) {
        const container = document.getElementById("translations-container");
        const translationBlock = document.createElement("div");
        translationBlock.className = "translation-container mb-3";
        translationBlock.innerHTML = `
                <h5>Translations for Question ${questionId}</h5>
                <div class="mb-3">
                    <label for="translation_question_text_${questionId}_fr" class="form-label">French Translation:</label>
                    <input type="text" class="form-control" id="translation_question_text_${questionId}_fr" name="translation_question_text_${questionId}_fr">
                </div>
                <div class="mb-3">
                    <label for="translation_question_text_${questionId}_ar" class="form-label">Arabic Translation:</label>
                    <input type="text" class="form-control" id="translation_question_text_${questionId}_ar" name="translation_question_text_${questionId}_ar">
                </div>
                <div class="mb-3" id="translations-options-${questionId}">
                    <h6>Translations for Options</h6>
                </div>
            `;
        container.appendChild(translationBlock);
      }

      // Initialize the form
      document
        .getElementById("add-question")
        .addEventListener("click", addQuestion);
    </script>
    {% endblock %}
  </body>
</html>
